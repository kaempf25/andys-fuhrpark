<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fahrzeugpark Andy</title>
    <!-- React und ReactDOM als UMD-Bundles -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <!-- Babel für In-Browser-Compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS für schnelles, buntes Styling -->
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100">
    <div id="root"></div>
    <script type="text/babel">
      /* --------------------------
         1) Konfiguration und Daten
      --------------------------- */
      const garages = [
        "Spexarder_Strasse",
        "Sparkasse_Avenwedde",
        "Mumprow",
        "Amrumweg"
      ];

      // Fahrzeugdaten – achte bitte genau auf die Dateinamen (Groß-/Kleinschreibung, Leerzeichen, Dateiendung)
      const vehiclesDataInitial = [
        {
          id: "mercedes-w113",
          name: "Mercedes W113 230 SL (Pagode)",
          type: "Auto",
          technical: "Klassischer 230 SL mit 2,3-Liter Reihen-Sechszylinder und ca. 150 PS.",
          imageUrl: "./Mercedes w113.jpeg",
          marketPrice: "120.000€",
          garage: "Spexarder_Strasse",
          note: "",
          specs: {
            Motor: "2,3L Reihen-Sechszylinder",
            Leistung: "150 PS",
            Baujahr: "1963",
            Besonderheiten: "Ikonisches Pagoden-Design, zeitloses Erscheinungsbild"
          }
        },
        {
          id: "mercedes-r107",
          name: "Mercedes R107 560 SL",
          type: "Auto",
          technical: "Luxuriöses Cabriolet mit 5,6-Liter V8 und ca. 230 PS.",
          imageUrl: "./Mercedes R107.jpeg",
          marketPrice: "150.000€",
          garage: "Sparkasse_Avenwedde",
          note: "",
          specs: {
            Motor: "5,6L V8",
            Leistung: "230 PS",
            Baujahr: "1986",
            Besonderheiten: "Hochkomfort, klassisches Design, luxuriöse Ausstattung"
          }
        },
        {
          id: "mercedes-r129",
          name: "Mercedes R129 500 SL",
          type: "Auto",
          technical: "Modernes Cabriolet mit 5,0-Liter V8 und ca. 326 PS.",
          imageUrl: "./Mercedes R129.jpeg",
          marketPrice: "20.000€",
          garage: "Spexarder_Strasse",
          note: "",
          specs: {
            Motor: "5,0L V8",
            Leistung: "326 PS",
            Baujahr: "1994",
            Besonderheiten: "Fortschrittliche Technik, elegantes Design, moderne Sicherheit"
          }
        },
        {
          id: "mercedes-w208",
          name: "Mercedes W208 230 CLK",
          type: "Auto",
          technical: "Kompakter 230 CLK – Kompressor – mit dynamischem Design.",
          imageUrl: "./Mervedes W208 CLK.jpeg",
          marketPrice: "8.000€",
          garage: "Sparkasse_Avenwedde",
          note: "",
          specs: {
            Motor: "2,3L",
            Leistung: "197 PS",
            Baujahr: "1999",
            Besonderheiten: "Kompakt, zuverlässig, dynamisch"
          }
        },
        {
          id: "vw-t6",
          name: "VW Bus T6 2.0 TDI (2017)",
          type: "Auto",
          technical: "Robuster VW Bus (2,0-Liter Diesel, ca. 150 PS) – ideal für Reisen.",
          imageUrl: "./VW T6.jpeg",
          marketPrice: "80.000€",
          garage: "Mumprow",
          note: "",
          specs: {
            Motor: "2,0L Diesel",
            Leistung: "150 PS",
            Baujahr: "2017",
            Besonderheiten: "Geräumig, vielseitig, ideal für Familienreisen"
          }
        },
        {
          id: "man-traktor",
          name: "MAN Traktor 2N1",
          type: "Landmaschine",
          technical: "Robuster Traktor (ca. 1,6-Liter Diesel, ca. 28 PS) – ideal für Landwirtschaft.",
          imageUrl: "./man-traktor.jpeg",
          marketPrice: "4.000€",
          garage: "Amrumweg",
          note: "",
          specs: {
            Motor: "ca. 1,6L Diesel",
            Leistung: "ca. 28 PS",
            Baujahr: "1962",
            Besonderheiten: "Extrem robust, wartungsfreundlich, ideal für den harten Einsatz"
          }
        },
        {
          id: "bmw-r80",
          name: "BMW R80",
          type: "Motorrad",
          technical: "Kultiges Motorrad (800cc, ca. 70 PS) – begehrtes Sammlerstück.",
          imageUrl: "./BMW R80.jpeg",
          marketPrice: "5.000€",
          garage: "Spexarder_Strasse",
          note: "",
          specs: {
            Motor: "800cc",
            Leistung: "50 PS",
            Baujahr: "1982",
            Besonderheiten: "Robust, zeitlos, klassischer Look"
          }
        },
        {
          id: "bmw-r1200gs",
          name: "BMW R1200 GS",
          type: "Motorrad",
          technical: "Modernes Adventure-Bike (1170cc, ca. 125 PS), ideal für Touren und Offroad.",
          imageUrl: "./BMW R1200GS.jpeg",
          marketPrice: "12.000€",
          garage: "Sparkasse_Avenwedde",
          note: "",
          specs: {
            Motor: "1170cc",
            Leistung: "125 PS",
            Baujahr: "2014",
            Besonderheiten: "Geländegängig, moderner Komfort, innovative Elektronik"
          }
        },
        {
          id: "vespa-gts300",
          name: "Vespa GTS 300",
          type: "Roller",
          technical: "Stilvoller Roller (278cc, ca. 23 PS), vereint klassisches Design mit moderner Technik.",
          imageUrl: "./Vespa 300.jpeg",
          marketPrice: "4.000€",
          garage: "Mumprow",
          note: "",
          specs: {
            Motor: "278cc",
            Leistung: "23 PS",
            Baujahr: "2014",
            Besonderheiten: "Hoher Fahrkomfort, ikonisches Design, wendig"
          }
        }
      ];

      // Globale Wartungsaufgaben (Checkboxen)
      const defaultMaintenanceTasks = [
        "Ölwechsel", "Zündkerzen prüfen", "Bremsen kontrollieren", "Reifendruck prüfen"
      ];

      /* --------------------------
         2) Haupt-App-Komponente
      --------------------------- */
      function FuhrparkApp() {
        // Zum Testen: Lösche alte localStorage-Daten (entferne diese Zeilen später, wenn die Speicherung dauerhaft sein soll)
        React.useEffect(() => {
          localStorage.removeItem('vehiclesData');
          localStorage.removeItem('maintenanceData');
          localStorage.removeItem('maintenanceTasks');
          localStorage.removeItem('maintenanceRecords');
        }, []);

        // Zustände
        const [vehiclesData, setVehiclesData] = React.useState(vehiclesDataInitial);
        const [maintenanceData, setMaintenanceData] = React.useState({});
        const [maintenanceTasks, setMaintenanceTasks] = React.useState(defaultMaintenanceTasks);
        const [maintenanceRecords, setMaintenanceRecords] = React.useState(() => {
          const saved = localStorage.getItem('maintenanceRecords');
          return saved ? JSON.parse(saved) : {};
        });
        const [selectedYear, setSelectedYear] = React.useState(2025);
        const [filterType, setFilterType] = React.useState("Alle");
        const [selectedVehicleId, setSelectedVehicleId] = React.useState(null);
        // Zustände für neue Wartungsdatensätze (freie Einträge)
        const [newMaintenanceTask, setNewMaintenanceTask] = React.useState("");
        const [newMaintenanceDate, setNewMaintenanceDate] = React.useState("");

        // Persistiere Daten in localStorage
        React.useEffect(() => {
          localStorage.setItem('vehiclesData', JSON.stringify(vehiclesData));
        }, [vehiclesData]);
        React.useEffect(() => {
          localStorage.setItem('maintenanceData', JSON.stringify(maintenanceData));
          // Simulierter API-Aufruf – hier durch echten Endpoint ersetzen
          saveMaintenanceToServer(maintenanceData);
        }, [maintenanceData]);
        React.useEffect(() => {
          localStorage.setItem('maintenanceTasks', JSON.stringify(maintenanceTasks));
        }, [maintenanceTasks]);
        React.useEffect(() => {
          localStorage.setItem('maintenanceRecords', JSON.stringify(maintenanceRecords));
          // Simulierter API-Aufruf – hier durch echten Endpoint ersetzen
          saveRecordsToServer(maintenanceRecords);
        }, [maintenanceRecords]);

        // Simulierte Server-Funktionen
        function saveMaintenanceToServer(data) {
          fetch("https://example.com/api/saveMaintenance", {
            method: "POST",
            body: JSON.stringify(data),
            headers: { "Content-Type": "application/json" }
          })
          .then(response => console.log("Wartungs-Checkbox-Daten gespeichert:", response))
          .catch(error => console.error("Fehler beim Speichern (Checkbox):", error));
        }
        function saveRecordsToServer(data) {
          fetch("https://example.com/api/saveRecords", {
            method: "POST",
            body: JSON.stringify(data),
            headers: { "Content-Type": "application/json" }
          })
          .then(response => console.log("Wartungsdatensätze gespeichert:", response))
          .catch(error => console.error("Fehler beim Speichern (Records):", error));
        }

        // Umschalten von Wartungsaufgaben (Checkboxen)
        const handleTaskToggle = (vehicleId, year, task) => {
          setMaintenanceData(prev => {
            const vehicleData = prev[vehicleId] || {};
            const yearData = vehicleData[year] || {};
            const currentStatus = yearData[task];
            const newYearData = { ...yearData, [task]: currentStatus ? null : new Date().toISOString() };
            return {
              ...prev,
              [vehicleId]: {
                ...vehicleData,
                [year]: newYearData
              }
            };
          });
        };

        // Neuen Wartungsdatensatz hinzufügen (freie Einträge)
        const handleAddMaintenanceRecord = () => {
          if (!newMaintenanceTask || !newMaintenanceDate) {
            alert("Bitte Wartungsdienst und Datum angeben.");
            return;
          }
          const record = { task: newMaintenanceTask, date: newMaintenanceDate };
          const currentRecords = maintenanceRecords[selectedVehicleId] || [];
          const updatedRecords = [...currentRecords, record];
          setMaintenanceRecords({
            ...maintenanceRecords,
            [selectedVehicleId]: updatedRecords
          });
          setNewMaintenanceTask("");
          setNewMaintenanceDate("");
        };

        // Öffne Modal (zentriert) beim Klick auf eine Fahrzeugkarte
        const openModal = (vehicleId, event) => {
          setSelectedVehicleId(vehicleId);
        };

        // Schließe Modal
        const closeModal = () => {
          setSelectedVehicleId(null);
        };

        // Jahre von 2025 bis 2050
        const years = [];
        for (let y = 2025; y <= 2050; y++) {
          years.push(y);
        }

        // Filterung der Fahrzeuge
        const filteredVehicles = vehiclesData.filter(vehicle =>
          filterType === "Alle" ? true : vehicle.type === filterType
        );

        // Finde das aktuell ausgewählte Fahrzeug (für das Modal)
        const modalVehicle = vehiclesData.find(v => v.id === selectedVehicleId) || vehiclesData[0];

        /* --------------------------
           3) Präsentations-Komponenten
        --------------------------- */
        function VehicleCard({ vehicle, isActive, onClick }) {
          return (
            <div 
              className={`border rounded-lg shadow-lg p-4 bg-gradient-to-br from-blue-100 to-purple-100 cursor-pointer transform hover:scale-105 transition-transform ${isActive ? 'border-green-600' : 'border-gray-300'}`}
              onClick={onClick}
            >
              <img src={vehicle.imageUrl} alt={vehicle.name} className="w-full h-40 object-cover rounded" />
              <h2 className="text-xl font-bold mt-2 text-blue-800">{vehicle.name}</h2>
              <p className="text-sm text-gray-700">{vehicle.technical}</p>
              <div className="mt-2 text-sm text-gray-800">
                <p><strong>Motor:</strong> {vehicle.specs.Motor}</p>
                <p><strong>Leistung:</strong> {vehicle.specs.Leistung}</p>
                <p><strong>Baujahr:</strong> {vehicle.specs.Baujahr}</p>
                <p><strong>Besonderheiten:</strong> {vehicle.specs.Besonderheiten}</p>
              </div>
              <div className="mt-2 text-sm">
                <p><strong>Marktpreis:</strong> {vehicle.marketPrice}</p>
                <p><strong>Garage:</strong> {vehicle.garage.replace(/_/g, " ")}</p>
              </div>
            </div>
          );
        }

        /* --------------------------
           4) Render-Funktion
        --------------------------- */
        return (
          <div className="p-4 flex flex-col items-center">
            <h1 className="text-4xl font-extrabold mb-6 text-center bg-gradient-to-r from-purple-600 to-pink-500 text-white py-4 rounded w-full max-w-4xl">
              Fahrzeugpark Andy
            </h1>
            
            {/* Filter */}
            <div className="mb-4 flex items-center justify-center space-x-4 w-full max-w-4xl">
              <label className="font-semibold text-lg">Fahrzeugtyp:</label>
              <select
                value={filterType}
                onChange={(e) => setFilterType(e.target.value)}
                className="border rounded px-2 py-1"
              >
                <option value="Alle">Alle</option>
                <option value="Auto">Auto</option>
                <option value="Motorrad">Motorrad</option>
                <option value="Roller">Roller</option>
                <option value="Landmaschine">Landmaschine</option>
              </select>
            </div>

            {/* Grid der Fahrzeugkarten */}
            <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-8 w-full max-w-4xl">
              {filteredVehicles.map(vehicle => (
                <div key={vehicle.id} onClick={(e) => openModal(vehicle.id, e)}>
                  <VehicleCard 
                    vehicle={vehicle} 
                    isActive={vehicle.id === selectedVehicleId} 
                  />
                </div>
              ))}
            </div>

            {/* Wartungskalender (Checkboxen) */}
            <div className="mb-6 w-full max-w-4xl">
              <label className="mr-2 font-semibold">Wartungskalender Jahr:</label>
              <select
                value={selectedYear}
                onChange={(e) => setSelectedYear(parseInt(e.target.value))}
                className="border rounded px-2 py-1"
              >
                {years.map(year => (
                  <option key={year} value={year}>{year}</option>
                ))}
              </select>
            </div>
            <div className="mb-6 bg-white p-4 rounded shadow w-full max-w-4xl">
              <h3 className="text-lg font-bold mb-2">Wartungsaufgaben (Checkboxen) für {selectedYear}</h3>
              <ul>
                {maintenanceTasks.map(task => {
                  const completedDate = maintenanceData[selectedVehicleId] &&
                    maintenanceData[selectedVehicleId][selectedYear] &&
                    maintenanceData[selectedVehicleId][selectedYear][task];
                  return (
                    <li key={task} className="mb-2">
                      <label>
                        <input
                          type="checkbox"
                          checked={!!completedDate}
                          onChange={() => handleTaskToggle(selectedVehicleId, selectedYear, task)}
                          className="mr-2"
                        />
                        {task}{" "}
                        {completedDate && (
                          <span className="text-green-600">
                            (Erledigt am {new Date(completedDate).toLocaleDateString()})
                          </span>
                        )}
                      </label>
                    </li>
                  );
                })}
              </ul>
              <button
                onClick={handleAddMaintenanceTask}
                className="bg-blue-600 text-white px-4 py-2 rounded mt-2"
              >
                Neuen Wartungsdienst hinzufügen
              </button>
            </div>

            {/* Modal für Fahrzeugdetails und Wartungsdatensätze */}
            {selectedVehicleId && (
              <div className="fixed inset-0 flex items-center justify-center z-50">
                <div className="absolute inset-0 bg-black opacity-50" onClick={closeModal}></div>
                <div className="relative bg-white rounded p-6 w-11/12 max-w-lg shadow-xl overflow-y-auto max-h-full">
                  <button onClick={closeModal} className="absolute top-2 right-2 text-red-600 font-bold text-xl">&times;</button>
                  <h2 className="text-2xl font-bold mb-4">Detailansicht: {modalVehicle.name}</h2>
                  <img
                    src={modalVehicle.imageUrl}
                    alt={modalVehicle.name}
                    className="w-full h-64 mb-4 object-contain border"
                  />
                  <div className="mb-4">
                    <label className="mr-2 font-semibold">Marktpreis:</label>
                    <input
                      type="text"
                      value={modalVehicle.marketPrice}
                      onChange={(e) => {
                        const newPrice = e.target.value;
                        setVehiclesData(vehiclesData.map(vehicle =>
                          vehicle.id === modalVehicle.id ? { ...vehicle, marketPrice: newPrice } : vehicle
                        ));
                      }}
                      className="border rounded px-2 py-1"
                    />
                  </div>
                  <div className="mb-4">
                    <label className="mr-2 font-semibold">Garage:</label>
                    <select
                      value={modalVehicle.garage}
                      onChange={(e) => {
                        const newGarage = e.target.value;
                        setVehiclesData(vehiclesData.map(vehicle =>
                          vehicle.id === modalVehicle.id ? { ...vehicle, garage: newGarage } : vehicle
                        ));
                      }}
                      className="border rounded px-2 py-1"
                    >
                      {garages.map((g, idx) => (
                        <option key={idx} value={g}>{g.replace(/_/g, " ")}</option>
                      ))}
                    </select>
                  </div>
                  <div className="mb-4">
                    <label className="block font-semibold mb-1">Notizen:</label>
                    <textarea
                      value={modalVehicle.note}
                      onChange={(e) => handleNoteChange(e, modalVehicle.id)}
                      className="w-full border rounded p-2"
                      placeholder="Hier Notizen zum Fahrzeug eingeben..."
                    />
                  </div>
                  <div className="mb-4">
                    <label className="mr-2 font-semibold">Foto ändern:</label>
                    <input
                      type="file"
                      accept="image/*"
                      onChange={(e) => handleImageUpload(e, modalVehicle.id)}
                      className="border rounded px-2 py-1"
                    />
                  </div>
                  
                  {/* Neuer Abschnitt für freie Wartungsdatensätze */}
                  <div className="mb-4 border-t pt-4">
                    <h3 className="text-xl font-bold mb-2">Wartungsdaten hinzufügen</h3>
                    <div className="flex flex-col space-y-2">
                      <input
                        type="text"
                        placeholder="Wartungsdienst (z. B. Ölwechsel)"
                        value={newMaintenanceTask}
                        onChange={(e) => setNewMaintenanceTask(e.target.value)}
                        className="border rounded px-2 py-1"
                      />
                      <input
                        type="date"
                        value={newMaintenanceDate}
                        onChange={(e) => setNewMaintenanceDate(e.target.value)}
                        className="border rounded px-2 py-1"
                      />
                      <button
                        onClick={handleAddMaintenanceRecord}
                        className="bg-blue-600 text-white px-4 py-2 rounded"
                      >
                        Eintrag hinzufügen
                      </button>
                    </div>
                    {maintenanceRecords[modalVehicle.id] && maintenanceRecords[modalVehicle.id].length > 0 && (
                      <div className="mt-4">
                        <h3 className="text-xl font-bold">Bisherige Wartungsdaten:</h3>
                        <ul className="list-disc pl-5">
                          {maintenanceRecords[modalVehicle.id].map((record, index) => (
                            <li key={index} className="text-sm">
                              {record.task} am {new Date(record.date).toLocaleDateString()}
                            </li>
                          ))}
                        </ul>
                      </div>
                    )}
                  </div>

                  <button onClick={closeModal} className="bg-green-600 text-white px-4 py-2 rounded w-full">
                    Änderungen speichern und schließen
                  </button>
                </div>
              </div>
            )}
          </div>
        );
      }

      // App rendern
      ReactDOM.render(<FuhrparkApp />, document.getElementById('root'));
    </script>
  </body>
</html>
