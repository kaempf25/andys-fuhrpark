<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fahrzeugpark Andy</title>
    <!-- React und ReactDOM als UMD-Bundles -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <!-- Babel für In-Browser-Compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS für schnelles Styling -->
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100">
    <div id="root"></div>
    <script type="text/babel">
      // Vordefinierte Garagen
      const garages = [
        "Spexarder Strasse",
        "Sparkasse Avenwedde",
        "Mumprow",
        "Amrumweg"
      ];

      // Fahrzeugdaten inklusive technischer Details, Bild-URLs, Marktpreis, Garage und Spezifika
      const vehiclesDataInitial = [
        {
          id: 'mercedes-w113',
          name: 'Mercedes W113 230 SL (Pagode)',
          type: 'Auto',
          technical: 'Klassischer 230 SL mit originalem Motor und eleganten Linien.',
          imageUrl: 'https://source.unsplash.com/300x200/?mercedes,w113',
          marketPrice: '120.000€',
          garage: 'Spexarder Strasse',
          specs: {
            Motor: '3,0L V8',
            Leistung: '220 PS',
            Baujahr: '1963',
            Besonderheiten: 'Klassisches Design, seltene Edition'
          }
        },
        {
          id: 'mercedes-r107',
          name: 'Mercedes R107 560 SL',
          type: 'Auto',
          technical: 'Leistungsstarker 560 SL, luxuriös und robust.',
          imageUrl: 'https://source.unsplash.com/300x200/?mercedes,r107',
          marketPrice: '150.000€',
          garage: 'Sparkasse Avenwedde',
          specs: {
            Motor: '5,6L V8',
            Leistung: '250 PS',
            Baujahr: '1970',
            Besonderheiten: 'Luxuriös, hoher Fahrkomfort'
          }
        },
        {
          id: 'mercedes-r129',
          name: 'Mercedes R129 500 SL',
          type: 'Auto',
          technical: 'Sportlich-eleganter 500 SL mit modernem Komfort.',
          imageUrl: 'https://source.unsplash.com/300x200/?mercedes,r129',
          marketPrice: '130.000€',
          garage: 'Spexarder Strasse',
          specs: {
            Motor: '5,0L V8',
            Leistung: '240 PS',
            Baujahr: '1989',
            Besonderheiten: 'Sportlich, elegantes Cabriolet'
          }
        },
        {
          id: 'mercedes-w208',
          name: 'Mercedes W208 230 CLK',
          type: 'Auto',
          technical: 'Kompakter 230 CLK mit dynamischem Design.',
          imageUrl: 'https://source.unsplash.com/300x200/?mercedes,w208',
          marketPrice: '110.000€',
          garage: 'Sparkasse Avenwedde',
          specs: {
            Motor: '2,3L',
            Leistung: '160 PS',
            Baujahr: '1993',
            Besonderheiten: 'Kompaktes Design, zuverlässig'
          }
        },
        {
          id: 'vw-t6',
          name: 'VW Bus T6 2.0 TDI (2017)',
          type: 'Auto',
          technical: 'Robuster VW Bus mit sparsamen 2.0 TDI, ideal für Reisen.',
          imageUrl: 'https://source.unsplash.com/300x200/?vw,bus',
          marketPrice: '80.000€',
          garage: 'Mumprow',
          specs: {
            Motor: '2,0L Diesel',
            Leistung: '150 PS',
            Baujahr: '2017',
            Besonderheiten: 'Geräumig, vielseitig'
          }
        },
        {
          id: 'man-traktor',
          name: 'MAN Traktor 2N1',
          type: 'Landmaschine',
          technical: 'Leistungsstarker Traktor, vielseitig und robust im Landbetrieb.',
          imageUrl: 'https://source.unsplash.com/300x200/?tractor',
          marketPrice: '90.000€',
          garage: 'Amrumweg',
          specs: {
            Motor: '6,0L Diesel',
            Leistung: '200 PS',
            Baujahr: '2005',
            Besonderheiten: 'Robust, hohe Zugkraft'
          }
        },
        {
          id: 'bmw-r80',
          name: 'BMW R80 Strich 7 (1984)',
          type: 'Motorrad',
          technical: 'Klassische BMW Maschine, robust und zeitlos im Design.',
          imageUrl: 'https://source.unsplash.com/300x200/?bmw,motorcycle',
          marketPrice: '20.000€',
          garage: 'Spexarder Strasse',
          specs: {
            Motor: '800cc',
            Leistung: '70 PS',
            Baujahr: '1984',
            Besonderheiten: 'Klassisch, Sammlerstück'
          }
        },
        {
          id: 'bmw-r1200gs',
          name: 'BMW R1200GS (2014)',
          type: 'Motorrad',
          technical: 'Moderne Abenteuermaschine, zuverlässig und komfortabel.',
          imageUrl: 'https://source.unsplash.com/300x200/?bmw,adventure',
          marketPrice: '25.000€',
          garage: 'Sparkasse Avenwedde',
          specs: {
            Motor: '1170cc',
            Leistung: '125 PS',
            Baujahr: '2014',
            Besonderheiten: 'Abenteuerlich, komfortabel'
          }
        },
        {
          id: 'vespa-gts300',
          name: 'Vespa GTS 300',
          type: 'Roller',
          technical: 'Stilvoller Roller, ideal für die Stadt, kombiniert klassischen Charme mit moderner Technik.',
          imageUrl: 'https://source.unsplash.com/300x200/?vespa',
          marketPrice: '8.000€',
          garage: 'Mumprow',
          specs: {
            Motor: '300cc',
            Leistung: '23 PS',
            Baujahr: '2020',
            Besonderheiten: 'Stilvoll, wendig'
          }
        }
      ];

      // Vordefinierte Wartungsaufgaben
      const defaultMaintenanceTasks = [
        "Ölwechsel", "Zündkerzen prüfen", "Bremsen kontrollieren", "Reifendruck prüfen"
      ];

      // Komponente für Fahrzeugkarten im Stil von Spielkarten
      function VehicleCard({ vehicle, isActive, onClick }) {
        return (
          <div 
            className={`border rounded-lg shadow-lg p-4 bg-white cursor-pointer transform hover:scale-105 transition-transform ${isActive ? 'border-green-600' : 'border-gray-300'}`}
            onClick={onClick}
          >
            <img src={vehicle.imageUrl} alt={vehicle.name} className="w-full h-40 object-cover rounded" />
            <h2 className="text-xl font-bold mt-2">{vehicle.name}</h2>
            <p className="text-sm text-gray-700">{vehicle.technical}</p>
            <div className="mt-2 text-sm">
              <p><strong>Motor:</strong> {vehicle.specs.Motor}</p>
              <p><strong>Leistung:</strong> {vehicle.specs.Leistung}</p>
              <p><strong>Baujahr:</strong> {vehicle.specs.Baujahr}</p>
              <p><strong>Besonderheiten:</strong> {vehicle.specs.Besonderheiten}</p>
            </div>
            <div className="mt-2">
              <p><strong>Marktpreis:</strong> {vehicle.marketPrice}</p>
              <p><strong>Garage:</strong> {vehicle.garage}</p>
            </div>
          </div>
        );
      }

      function FuhrparkApp() {
        const [vehiclesData, setVehiclesData] = React.useState(() => {
          const saved = localStorage.getItem('vehiclesData');
          return saved ? JSON.parse(saved) : vehiclesDataInitial;
        });
        const [activeVehicle, setActiveVehicle] = React.useState(vehiclesData[0].id);
        // Wartungsdaten: { [vehicleId]: { [year]: { [task]: timestamp|null } } }
        const [maintenanceData, setMaintenanceData] = React.useState(() => {
          const saved = localStorage.getItem('maintenanceData');
          return saved ? JSON.parse(saved) : {};
        });
        const [selectedYear, setSelectedYear] = React.useState(2025);

        // Persistenz in localStorage
        React.useEffect(() => {
          localStorage.setItem('vehiclesData', JSON.stringify(vehiclesData));
        }, [vehiclesData]);
        React.useEffect(() => {
          localStorage.setItem('maintenanceData', JSON.stringify(maintenanceData));
        }, [maintenanceData]);

        // Umschalten der Wartungsaufgaben
        const handleTaskToggle = (vehicleId, year, task) => {
          setMaintenanceData(prev => {
            const vehicleData = prev[vehicleId] || {};
            const yearData = vehicleData[year] || {};
            const currentStatus = yearData[task];
            const newYearData = { ...yearData, [task]: currentStatus ? null : new Date().toISOString() };
            return {
              ...prev,
              [vehicleId]: {
                ...vehicleData,
                [year]: newYearData
              }
            };
          });
        };

        // Ermitteln des aktiven Fahrzeugs
        const activeVehicleData = vehiclesData.find(v => v.id === activeVehicle);

        // Array der Jahre 2025 bis 2050
        const years = [];
        for (let y = 2025; y <= 2050; y++) {
          years.push(y);
        }

        // Bild-Upload
        const handleImageUpload = (e) => {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onloadend = () => {
              const newImageUrl = reader.result;
              const updatedVehicles = vehiclesData.map(vehicle => {
                if (vehicle.id === activeVehicle) {
                  return { ...vehicle, imageUrl: newImageUrl };
                }
                return vehicle;
              });
              setVehiclesData(updatedVehicles);
            };
            reader.readAsDataURL(file);
          }
        };

        // Garage ändern
        const handleGarageChange = (e) => {
          const newGarage = e.target.value;
          const updatedVehicles = vehiclesData.map(vehicle => {
            if (vehicle.id === activeVehicle) {
              return { ...vehicle, garage: newGarage };
            }
            return vehicle;
          });
          setVehiclesData(updatedVehicles);
        };

        // Marktpreis ändern
        const handleMarketPriceChange = (e) => {
          const newPrice = e.target.value;
          const updatedVehicles = vehiclesData.map(vehicle => {
            if (vehicle.id === activeVehicle) {
              return { ...vehicle, marketPrice: newPrice };
            }
            return vehicle;
          });
          setVehiclesData(updatedVehicles);
        };

        return (
          <div className="p-4">
            <h1 className="text-3xl font-bold mb-6 text-center">Fahrzeugpark Andy</h1>
            
            {/* Grid der Fahrzeugkarten */}
            <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-8">
              {vehiclesData.map(vehicle => (
                <VehicleCard 
                  key={vehicle.id} 
                  vehicle={vehicle} 
                  isActive={vehicle.id === activeVehicle} 
                  onClick={() => setActiveVehicle(vehicle.id)}
                />
              ))}
            </div>

            {/* Detailbereich für aktives Fahrzeug */}
            <div className="mb-6 border p-4 rounded shadow bg-white">
              <h2 className="text-2xl font-bold mb-4">Detailansicht: {activeVehicleData.name}</h2>
              <img src={activeVehicleData.imageUrl} alt={activeVehicleData.name} className="w-full h-auto mb-4" />
              <div className="mb-4">
                <label className="mr-2 font-semibold">Marktpreis:</label>
                <input type="text" value={activeVehicleData.marketPrice} onChange={handleMarketPriceChange} className="border rounded px-2 py-1" />
              </div>
              <div className="mb-4">
                <label className="mr-2 font-semibold">Garage:</label>
                <select value={activeVehicleData.garage} onChange={handleGarageChange}>
                  {garages.map((g, idx) => (
                    <option key={idx} value={g}>{g}</option>
                  ))}
                </select>
              </div>
              <div className="mb-4">
                <label className="mr-2 font-semibold">Bild hochladen:</label>
                <input type="file" accept="image/*" onChange={handleImageUpload} />
              </div>
            </div>

            {/* Wartungskalender */}
            <div className="mb-6">
              <label className="mr-2 font-semibold">Wartungskalender Jahr:</label>
              <select value={selectedYear} onChange={(e) => setSelectedYear(parseInt(e.target.value))}>
                {years.map(year => (
                  <option key={year} value={year}>{year}</option>
                ))}
              </select>
            </div>
            <div className="mb-6 bg-white p-4 rounded shadow">
              <h3 className="text-lg font-bold mb-2">Wartungsaufgaben für {selectedYear}</h3>
              <ul>
                {defaultMaintenanceTasks.map(task => {
                  const completedDate = maintenanceData[activeVehicle] &&
                    maintenanceData[activeVehicle][selectedYear] &&
                    maintenanceData[activeVehicle][selectedYear][task];
                  return (
                    <li key={task} className="mb-2">
                      <label>
                        <input
                          type="checkbox"
                          checked={!!completedDate}
                          onChange={() => handleTaskToggle(activeVehicle, selectedYear, task)}
                        />
                        <span className="ml-2">
                          {task} {completedDate && <span className="text-green-600">(Erledigt am {new Date(completedDate).toLocaleDateString()})</span>}
                        </span>
                      </label>
                    </li>
                  );
                })}
              </ul>
            </div>
          </div>
        );
      }

      ReactDOM.render(<FuhrparkApp />, document.getElementById('root'));
    </script>
  </body>
</html>
